(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{670:function(e,t,s){Promise.resolve().then(s.bind(s,4456))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},4456:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(7437),r=s(2265),n=s(9376),i=s(3145),o=s(7648);function l(e){let{params:t}=e,[s,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),[m,h]=(0,r.useState)(""),[u,x]=(0,r.useState)(""),[p,f]=(0,r.useState)(!1),[j,b]=(0,r.useState)(!1),[v,y]=(0,r.useState)(!1),g=(0,n.useRouter)();(0,r.useEffect)(()=>{b(!!localStorage.getItem("token")),N()},[t.id]);let N=async()=>{try{let e=await fetch("/api/photos/".concat(t.id)),s=await e.json();if(!e.ok)throw Error(s.error||"Failed to fetch photo");l(s.data)}catch(e){h(e.message)}finally{d(!1)}},w=async()=>{if(!j){g.push("/login");return}if(!v){y(!0);try{let e=localStorage.getItem("token"),s=await fetch("/api/photos/".concat(t.id,"/vote"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),a=await s.json();if(!s.ok)throw Error(a.error||"Failed to vote");l(e=>e?{...e,votes:e.votes+1}:null)}catch(e){h(e.message)}finally{y(!1)}}},S=async e=>{if(e.preventDefault(),!j){g.push("/login");return}if(u.trim()&&!p){f(!0);try{let e=localStorage.getItem("token"),s=await fetch("/api/photos/".concat(t.id,"/comments"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({content:u})}),a=await s.json();if(!s.ok)throw Error(a.error||"Failed to add comment");x(""),N()}catch(e){h(e.message)}finally{f(!1)}}};return c?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):m?(0,a.jsx)("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-md",children:m}):s?(0,a.jsxs)("div",{className:"py-8",children:[(0,a.jsx)(o.default,{href:"/photos",className:"text-primary hover:underline mb-4 inline-block",children:"← Back to photos"}),(0,a.jsxs)("div",{className:"card mt-4",children:[(0,a.jsx)("div",{className:"relative w-full aspect-video mb-4",children:(0,a.jsx)(i.default,{src:s.image_url,alt:s.title,className:"rounded-lg object-contain",fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 70vw",priority:!0})}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:s.title}),(0,a.jsxs)("button",{onClick:w,disabled:v,className:"flex items-center gap-1 px-3 py-1 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),(0,a.jsx)("span",{children:s.votes})]})]}),s.description&&(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:s.description}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-500 mb-8",children:[(0,a.jsxs)("span",{children:["By ",s.author]}),(0,a.jsx)("span",{className:"mx-2",children:"•"}),(0,a.jsx)("span",{children:new Date(s.created_at).toLocaleDateString()})]}),(0,a.jsxs)("div",{className:"border-t pt-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Comments"}),(0,a.jsx)("form",{onSubmit:S,className:"mb-6",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),placeholder:j?"Add a comment...":"Log in to comment",disabled:!j||p,className:"form-input flex-grow"}),(0,a.jsx)("button",{type:"submit",disabled:!j||!u.trim()||p,className:"btn-primary px-4 disabled:opacity-50",children:"Post"})]})}),s.comments&&s.comments.length>0?(0,a.jsx)("div",{className:"space-y-4",children:s.comments.map(e=>(0,a.jsxs)("div",{className:"border-b pb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"font-medium",children:e.username}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString()})]}),(0,a.jsx)("p",{className:"mt-1",children:e.content})]},e.id))}):(0,a.jsx)("p",{className:"text-gray-500 italic",children:"No comments yet. Be the first to comment!"})]})]})]}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-xl text-gray-500",children:"Photo not found"}),(0,a.jsx)(o.default,{href:"/photos",className:"mt-4 inline-block text-primary hover:underline",children:"Back to photos"})]})}}},function(e){e.O(0,[648,145,971,117,744],function(){return e(e.s=670)}),_N_E=e.O()}]);